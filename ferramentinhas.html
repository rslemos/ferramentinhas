<html>
	<head>
		<meta charset="utf-8">
		<title>Ferramentinhas</title>

		<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

		<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/jquery-ui.min.js"></script>
		<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/themes/ui-darkness/jquery-ui.css" />

		<script src="ferramentinhas.js" type="text/javascript"></script>
		<link rel="stylesheet" href="ferramentinhas.css">

		<script>
			$(function() { 
				$("#toolbox").accordion({
					collapsible: true,
					heightStyle: 'content'
				});

				$("button").button();
				$('button').draggable({
					cancel: false, 
					opacity: 0.75,
					zIndex: 100,
					scope: 'tool',
					helper: function(event) {
						var target = $(event.currentTarget);
						var clone = target.clone();
						clone.css({
							width: target.outerWidth()
						});
						return clone;
					}
				});
				
				var dropOptions = {
					scope: 'tool',
					hoverClass: 'alvo-hover',
					activeClass: 'alvo-ativo',
					drop: function(event, ui) {
						var td = $(event.target);
						$('<tr><td></td></tr>').appendTo(td.closest('tbody')).children('td').droppable(dropOptions);

						var div = $('<div></div>').appendTo(td);
						var textarea = $('<textarea class="stdin" cols="80" rows="25"></textarea>').appendTo(div);

					}
				};

				$('#workplace > table > tbody > tr > td').droppable(dropOptions);
			});
		</script>
	</head>

	<body>
		<div id="toolbox">
			<h3>Lista de linhas</h3>
			<div>
				<button>Entrada de texto <span style="font-size: 80%; float: right;">(stdin)</span></button>
				<button>Sa√≠da de texto <span style="font-size: 80%; float: right;">(stdout)</span></button>
				<button>Ordenador <span style="font-size: 80%; float: right;">sort</span></button>
			</div>

			<h3>Lista de registros</h3>
			<div >

			</div>
		</div>
		<div id="splitworkplace"></div>
		<div id="workplace">
			<table>
				<tr>
					<td>
						<div>
							<textarea id="stdin" class="stdin" cols="80" rows="5"></textarea>
						</div>
						<script type="text/javascript">
							$(function() {

								$('textarea#stdin').keyup(delay).on('paste', delay).on('cut', delay);

								var timeout;
								function delay() {
									timeout && clearTimeout(timeout);
									timeout = setTimeout(done, 1000);
								}

								function done() {
									timeout = null;
									var thistd = $('textarea#stdin').closest('td');
									thistd.data('buffer', $('textarea#stdin').val().split('\n'));
									thistd.data('change')();
								}
							});
						</script>
					</td>
				</tr>
				<tr>
					<td>
						<div id="sort">
							<div id="direction">
								<input type="radio" id="asc"  name="radio" checked="checked"><label for="asc" >Crescente</label>
								<input type="radio" id="desc" name="radio"                  ><label for="desc">Decrescente</label>
							</div>
							<script type="text/javascript">
								$(function() {
									$('div#sort').children('div#direction').buttonset();
									var thistd = $('div#sort').closest('td');
									var prevtd = thistd.parent().prev().children('td');
									prevtd.data('change', function() {
										var buffer = prevtd.data('buffer').slice();
										buffer.sort();
										thistd.data('buffer', buffer);
										thistd.data('change')();
									});
								});
							</script>
						</div>
					</td>
				</tr>
				<tr>
					<td>
						<div>
							<pre id="stdout" class="stdout"></pre>
							<script type="text/javascript">
								var thistd = $('pre#stdout').closest('td');
								var prevtd = thistd.parent().prev().children('td');
								prevtd.data('change', function() {
									var buffer = prevtd.data('buffer').join('\n');
									$('pre#stdout').empty().append(buffer);
								});
							</script>
						</div>
					</td>
				</tr>
			</table>
		</div>
	</body>
</html>