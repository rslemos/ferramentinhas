<html>
	<head>
		<meta charset="utf-8">
		<title>Sort - Ferramentinhas</title>

		<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

		<script type="text/javascript">
			function postponeInvocationUntilQuiescent(fn, ms) {
				var timeout = null;
				return function() {
					timeout && clearTimeout(timeout);

					// capture this and arguments
					var t = this;
					var args = Array.prototype.slice.call(arguments, 0);
					timeout = setTimeout(function() {
						timeout = null;
						fn.apply(t, args);
					}, ms);
				};
			}

			function sort() {
				var buffer = $('#stdin').val().split('\n');
				if (buffer.slice(-1)[0] == '')
					buffer = buffer.slice(0, -1);

				var accent = parseInt($('select[name="accent"]').val());
				var caze = parseInt($('select[name="case"]').val());

				var sensitivity = accent << 1 | caze;

				var locale = $('input[name="locale"]').val();

				var compare = locale == ''
					? function(a,b) { return a == b ? 0 : a < b ? -1 : 1; }
					: new Intl.Collator(locale, { sensitivity: ['variant', 'accent', 'case', 'base'][sensitivity] }).compare;

				if ($('select[name="direction"]').val() == 'desc')
					compare = (function(compare){ return function(a,b) { return -compare(a,b); }; })(compare);

				buffer.sort(compare);
				$('#stdout').empty().append(buffer.join('\n'));
			}

			$(function() {

				// sort immediately
				sort();

				$('select').change(sort);

				sort = postponeInvocationUntilQuiescent(sort, 2000);
				$('#stdin').keyup(sort).on('cut', sort).on('paste', sort);
				$('input').keyup(sort).on('cut', sort).on('paste', sort);
			});
		</script>
	</head>

	<body>
		<header>
			<select name="direction">
				<option value="asc" selected>Crescente</option>
				<option value="desc"        >Descrescente</option>
			</select>
			
			<label for="locale">Locale</label>
			<input type="text" name="locale">
			
			<label for="accent">Acentos são</label>
			<select name="accent">
				<option value="1"         >iguais (a = á)</option>
				<option value="0" selected>diferentes (a ≠ á)</option>
			</select>
			
			<label for="case">Maiúsculas e minúsculas</label>
			<select name="case">
				<option value="1"         >iguais (a = A)</option>
				<option value="0" selected>diferentes (a ≠ A)</option>
			</select>
		</header>
		<textarea id="stdin"></textarea>
		<pre id="stdout"></pre>
	</body>
</html>
